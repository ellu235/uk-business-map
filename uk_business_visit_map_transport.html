<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±å›½ä¼ä¸šå‚è®¿åœ°å›¾ï¼ˆå®æ—¶äº¤é€šè§„åˆ’è·³è½¬ï¼‰</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet æ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* å¼•å…¥Interå­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
        }
        #map {
            height: 70vh; /* ä¸ºåº•éƒ¨çš„äº¤é€šé¢æ¿è…¾å‡ºç©ºé—´ */
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            will-change: transform;
        }
        
        /* è‡ªå®šä¹‰æ ‡è®°æ ·å¼ï¼šè½»é‡çº§çš„å½©è‰²åœ†ç‚¹ */
        .custom-marker-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.6);
            cursor: pointer;
            transition: transform 0.1s ease-out;
        }
        .custom-marker-dot:hover {
            transform: scale(1.3);
        }

        /* ä¼˜å…ˆçº§é¢œè‰²å®šä¹‰ */
        .marker-p1 { background-color: #ef4444; } /* Red: P1 é¡¾å®¢ */
        .marker-p2 { background-color: #3b82f6; } /* Blue: P2 é‡ç‚¹é¡¾å®¢ */
        .marker-p3 { background-color: #10b981; } /* Green: P3 å…¶ä»– */

        /* é€‰ä¸­æ ‡è®°æ ·å¼ */
        .marker-selected { 
            border: 4px solid #f97316; /* Orange 500 */
            transform: scale(1.5) !important;
        }
        
        /* å¼¹å‡ºçª—å£æ ·å¼ (Tailwind-like) */
        .leaflet-popup-content-wrapper {
            border-radius: 0.5rem;
            padding: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .leaflet-popup-content {
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        /* è‡ªå®šä¹‰å¼¹çª—æ ·å¼ */
        #custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">
            è‹±å›½ä¼ä¸šå‚è®¿åœ°ç‚¹å¯è§†åŒ–
            <span class="text-sm font-normal text-gray-500 ml-2"> (ç‚¹å‡»ä»»æ„ä¸¤ç‚¹ï¼Œè§„åˆ’å®æ—¶äº¤é€š)</span>
        </h1>
        
        <!-- ä¼˜å…ˆçº§å›¾ä¾‹ -->
        <div class="flex flex-wrap gap-6 mb-6 text-sm font-semibold">
            <div class="flex items-center">
                <div class="custom-marker-dot marker-p1 mr-2 flex-shrink-0"></div> P1: é¡¾å®¢ (é«˜ä¼˜å…ˆçº§)
            </div>
            <div class="flex items-center">
                <div class="custom-marker-dot marker-p2 mr-2 flex-shrink-0"></div> P2: é‡ç‚¹é¡¾å®¢ (ä¸­ä¼˜å…ˆçº§)
            </div>
            <div class="flex items-center">
                <div class="custom-marker-dot marker-p3 mr-2 flex-shrink-0"></div> P3: å…¶ä»– (ä¸€èˆ¬ä¼˜å…ˆçº§)
            </div>
        </div>

        <div id="map"></div>

        <!-- äº¤é€šè§„åˆ’é¢æ¿ -->
        <div id="transport-panel" class="mt-8 bg-white p-6 rounded-xl shadow-2xl border-t-4 border-indigo-500 transition-all duration-300">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-4.5-5.5a.5.5 0 01.5-.5h7a.5.5 0 010 1H6a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h7a.5.5 0 010 1H6a.5.5 0 01-.5-.5z" clip-rule="evenodd" />
                </svg>
                å‚è®¿äº¤é€šè§„åˆ’ (è·³è½¬è‡³ Google Maps)
            </h2>
            
            <!-- é€‰ä¸­çš„åœ°ç‚¹ -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b pb-3 mb-4">
                <div class="mb-2 md:mb-0">
                    <p class="text-sm font-medium text-gray-500">èµ·ç‚¹ (A): <span id="start-location" class="text-gray-800 font-semibold">- å¾…å®š -</span></p>
                    <p class="text-sm font-medium text-gray-500">ç»ˆç‚¹ (B): <span id="end-location" class="text-gray-800 font-semibold">- å¾…å®š -</span></p>
                </div>
                <button id="reset-button" class="bg-red-100 text-red-600 px-3 py-1 text-sm font-medium rounded-full hover:bg-red-200 transition-colors hidden" onclick="resetSelection()">é‡ç½®é€‰æ‹©</button>
            </div>

            <!-- è§„åˆ’æŒ‰é’®åŒºåŸŸ -->
            <div id="planning-buttons" class="hidden">
                <p class="text-gray-600 mb-3 font-medium">è¯·é€‰æ‹©å‡ºè¡Œæ–¹å¼ï¼š</p>
                <div class="flex flex-wrap gap-4">
                    <button 
                        class="flex items-center bg-indigo-600 text-white px-5 py-2 rounded-lg font-semibold shadow-md hover:bg-indigo-700 transition-all duration-200"
                        onclick="openGoogleMaps('driving')">
                        ğŸš— é©¾è½¦è·¯çº¿ (Google Maps)
                    </button>
                    <button 
                        class="flex items-center bg-green-600 text-white px-5 py-2 rounded-lg font-semibold shadow-md hover:bg-green-700 transition-all duration-200"
                        onclick="openGoogleMaps('transit')">
                        ğŸšŒ å…¬å…±äº¤é€š (Google Maps)
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-4 italic">
                    ç‚¹å‡»æŒ‰é’®åï¼Œå°†ä¼šåœ¨æ–°çª—å£æ‰“å¼€ Google Maps å®æ—¶è·¯çº¿è§„åˆ’ã€‚
                </p>
            </div>
            
            <!-- åˆå§‹æç¤º -->
            <p id="initial-prompt" class="text-gray-600 italic font-medium">è¯·åœ¨åœ°å›¾ä¸Šè¿ç»­ç‚¹å‡»ä¸¤ä¸ªæ ‡è®°ç‚¹ï¼Œä»¥è§„åˆ’Aåˆ°Bçš„äº¤é€šã€‚</p>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰å¼¹çª— (æ›¿ä»£ alert) -->
    <div id="custom-modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-red-600 mb-3">æ³¨æ„</h3>
            <p id="modal-message" class="text-gray-700 mb-5">æ¶ˆæ¯å†…å®¹</p>
            <button class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600" onclick="hideCustomAlert()">ç¡®å®š</button>
        </div>
    </div>

    <!-- Leaflet JS CDN -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // åŸå§‹ CSV æ ¼å¼æ•°æ® (ä¸ä¸Šä¸€ä¸ªæ–‡ä»¶ä¿æŒä¸€è‡´)
        const rawData = `åå­—	ä¸»è¥ä¸šåŠ¡	ç½‘å€	åœ°å€	å¤‡æ³¨	è´Ÿè´£äºº	è¥ä¸šæ—¶é—´
Esterform Packaging 	-	-	Royds Farm Rd, Holbeck, Leeds LS12 6DX	é¡¾å®¢	å˜å§	
ORANGE & ORANGE LTD	-	-	24 BELFRY LANE, COLLINGTREE, NORTHAMPTON, NN4 0PB	é¡¾å®¢	å˜å§	
Sharpak	-	-	Aylesham Ind Est, Aylesham, Kent, CT3 3EF, UK	é¡¾å®¢	Desmond	
Bell Packaging Ltd.	ç¯ä¿å¯å›æ”¶å¡‘æ–™åŒ…è£…è§£å†³æ–¹æ¡ˆçš„åˆ¶é€ ä¸ä¾›åº”	http://www.bellpackaging.com	Unit 8 Barratt Industrial Park, Airport Way, Luton, Bedfordshire, LU2 9NH	æœ‰è¿›å£è®°å½•	+44 1582459292	9â€¯amâ€“5â€¯am(åº”è¯¥æ˜¯å®˜ç½‘æ‰‹è¯¯ï¼‰
Amcor Packaging Uk Ltd.	ä¸“æ³¨äºä¸ºé£Ÿå“ã€é¥®æ–™ã€åŒ»è¯åŠä¸ªäººæŠ¤ç†ç­‰è¡Œä¸šè®¾è®¡å¹¶ç”Ÿäº§å¯æŒç»­çš„æŸ”æ€§åŒ…è£…ï¼ˆå¦‚é«˜é˜»éš”è–„è†œã€å¯å›æ”¶æ”¶ç¼©è¢‹ï¼‰å’Œç¡¬åŒ…è£…ï¼ˆå¦‚è½»é‡åŒ– PET ç“¶ã€åŒ»è¯æ³¡ç½©å®¹å™¨ï¼‰	https://www.amcor.com/	83 Tower Road North, BS30 8XP (headquater); 4 Sallow Rd, Corby NN17 5JX, United Kingdom (Amcor Corby, T/A RPC Containers LTD); Haslingden Rd, Blackburn BB1 2PX, United Kingdom (Amcor Blackburn)	æ¾³æ´²å¼€å‘ä¸­	+441179753200	8â€¯amâ€“5â€¯pm (Fri3pm)
Wrapid Mfg Ltd.	è‹±å›½é£Ÿå“å·¥ä¸šåŒ…è£…è–„è†œé¢†å…ˆåˆ†é”€å•†ï¼Œä¸“æ³¨äºçƒ­å°ç›–è†œï¼ˆç‰¹åˆ«æ˜¯MylarÂ®å“ç‰Œï¼‰ã€å±‚å‹è–„è†œã€èšé…¯è¢‹å’Œå¯çƒ˜çƒ¤è¡¨çš®è–„è†œï¼Œä¸ºé£Ÿå“åŠ å·¥å’ŒåŒ…è£…è¡Œä¸šæä¾›è€çƒ­ç›–è†œè§£å†³æ–¹æ¡ˆ	https://www.wrapid.co.uk	250 Thornton Rd, Bradford BD1 2LB, United Kingdom	æœ‰è¿›å£è®°å½•	+441274220220	8:15am-5:15pm å‘¨äº”ä¸å¼€
HotPack Packaging UK LTD	é£Ÿå“åŒ…è£…åˆ¶é€ ï¼ˆå¦‚å®¹å™¨ã€æ‰˜ç›˜ï¼‰	http://h-packglobal.com	Hotpack Complex, Davy Way, Llay, Wrexham LL12 0PG, United Kingdom	å·²ç­¾é˜¿è”é…‹	+441978855595	9â€¯amâ€“5:30â€¯pm
Modern Packaging Ltd.	æŸ”æ€§åŒ…è£…å°åˆ·ã€å±‚å‹ã€åˆ†åˆ‡å’Œå¤å·æœåŠ¡ï¼Œä»¥åŠç‰¹ç§è–„è†œäº§å“ï¼ˆå¦‚ç©¿å­”è–„è†œã€çº¸å¼ å±‚å‹å’Œå¯å›æ”¶è–„è†œï¼‰	https://modern-packaging.co.uk	Ascot Rd, Pershore WR10 2JJ, United Kingdom	æœ‰è¿›å£è®°å½•	+44 1242262002	-
Bell Packaging Ltd.	ç¯ä¿å¯å›æ”¶å¡‘æ–™åŒ…è£…è§£å†³æ–¹æ¡ˆçš„åˆ¶é€ ä¸ä¾›åº”	http://www.bellpackaging.com	Unit 8 Barratt Industrial Park, Airport Way, Luton, Bedfordshire, LU2 9NH	æœ‰è¿›å£è®°å½•	+44 1582459292	9â€¯amâ€“5â€¯am
Clifton Packaging Group Ltd.	æŸ”æ€§åŒ…è£…è–„è†œå’ŒåŒ…è£…è¢‹åˆ¶é€ 	http://www.cliftonpackaging.co.uk	Meridian Business Park, Centurion Way, Leicester, LE19 1WH, UK	æœ‰è¿›å£è®°å½•	+44 (0)116 289 3355	9â€¯amâ€“5â€¯pm
Celli Uk	å¤§é‡è¿›å£petä½†ä¸ç›´æ¥ä½¿ç”¨ï¼Œè®¾è®¡ã€åˆ¶é€ å’Œæä¾›åˆ›æ–°çš„é¥®æ–™åˆ†é…ä¸ dispensing ç³»ç»ŸåŠè§£å†³æ–¹æ¡ˆ	https://celli.com	Thirsk Industrial Park, York Rd, Thirsk YO7 3BX, United Kingdom	æœ‰è¿›å£è®°å½•	+441423324555	7:30â€¯amâ€“4:30â€¯pm
Perimeter General Trading Llc	åŒ…è£…ç›–è†œè§£å†³æ–¹æ¡ˆ	https://www.perimeterfc.com	Meridian Business Park, Centurion Way, LE19 1WH, UK	æœ‰è¿›å£è®°å½•		7:30â€¯amâ€“4:30â€¯pm
Sappi Rockwell Solutions Ltd.	PETç“¶å›æ”¶å’ŒrPETåˆ¶é€ 	https://www.rockwellsolutions.co.uk	Brunel Road, Dundee DD2 4TG, Scotland, UK	æœ‰è¿›å£è®°å½•	+44 1382622122	9â€¯amâ€“5â€¯pm(Fri2pm)
Staeger Clear Packaging Ltd.	æ¬§æ´²é¢†å…ˆçš„ç‰¹å®šåº”ç”¨é€æ˜å’Œçƒ­æˆå‹å¡‘æ–™åŒ…è£…è§£å†³æ–¹æ¡ˆæä¾›å•†ï¼Œä¸“æ³¨äºç³–æœã€é£Ÿå“ã€åŒ–å¦†å“ã€çººç»‡å“/éé£Ÿå“ã€æŠ€æœ¯å·¥ä¸šå’Œæ±½è½¦è¡Œä¸šçš„æ³¡ç½©ã€ç¿»ç›–ã€æ‰˜ç›˜ã€æ’å…¥ä»¶ã€å·¥ä»¶è½½ä½“å’Œæ··åˆåŒ…è£…	http://staegerclear.co.uk	Units 6, Bermuda Industrial Estate, 8 Buckingham Cl, St Georges Way, Nuneaton CV10 7JT, United Kingdom	æœ‰è¿›å£è®°å½•	+44 24 76 581197	8:30â€¯amâ€“4:30â€¯pm
Alpla UK	å¡‘æ–™åŒ…è£…è§£å†³æ–¹æ¡ˆ	https://www.alpla.com/en	Unit 9, The Stonecross, Stonecross Business Park, Yew Tree Way, Golborne, Warrington WA3 3GY, United Kingdom (Headquater); Lasborough Rd, Kingston, Milton Keynes MK10 0AB, United Kingdom (Official address); 	æœ‰è¿›å£è®°å½•	+44 8456447544	
Logoplaste UK	å¡‘æ–™åŒ…è£…è®¾è®¡å’Œåˆ¶é€ 	https://www.logoplaste.com/	Hedley Ave, Grays RM20 4AL, United Kingdom	å¤§å…¬å¸ï¼Œä¸»å…¬å¸usaï¼Œè¿‘æœŸåªä¹°æ–°æ–™	+441189719770	-
Kempner Ltd.	æ”¶ç¼©åŒ…è£…å’Œå¯æŒç»­åŒ…è£…è§£å†³æ–¹æ¡ˆ	https://www.kempner.co.uk	498-500HONEYPOT LANE STANMORE MIDDLESEX MDDSX HA7 1JZ UK TECONTACTO MR. RICHAR JANKEL		+44 2089525262	9â€¯amâ€“5:30â€¯pm
Pont Packaging Ltd	ä¹°æˆå“ï¼Œå¯æŒç»­åŒ…è£…è§£å†³æ–¹æ¡ˆå…¨çƒåˆä½œä¼™ä¼´ï¼Œä¸“æ³¨äºä¸ºç»´ç”Ÿç´ ä¸è¿åŠ¨è¥å…»ã€åŒ–å­¦å“ã€éå¤„æ–¹è¯/è¯å“ã€ä¸ªäººæŠ¤ç†ã€é£Ÿå“é¥®æ–™ã€å® ç‰©æŠ¤ç†ç­‰è¡Œä¸šæä¾›ç»ç’ƒç½ã€ç»ç’ƒç“¶ã€å¡‘æ–™ç½ã€å¡‘æ–™ç“¶ã€ç“¶ç›–åŠé…ä»¶	https://www.ponteurope.com/	2 Steuber Drive, Irlam, Manchester M44 5AL, UK	æœ‰è¿›å£è®°å½•	+44 161 874 1930	8:30â€¯amâ€“4â€¯pm
Kingfisher Packaging Ltd.	è‹±å›½ç»¼åˆæ€§åŒ…è£…ææ–™ä¾›åº”å•†ï¼Œæä¾›çº¸ç®±ã€èƒ¶å¸¦ã€ä¿æŠ¤æ€§åŒ…è£…ææ–™ã€æ‰˜ç›˜ç¼ ç»•è†œã€èšä¹™çƒ¯äº§å“ã€é‚®æ”¿åŒ…è£…ã€åŒ…è£…æœºæ¢°ã€æ†æ‰å¸¦ã€çº¸åˆ¶å“ã€æ ‡ç­¾åŠå®šåˆ¶åŒ…è£…ç­‰å…¨ç³»åˆ—äº§å“	http://www.kingfisherpackaging.com	Pleamore Cross Business Park, Wrangway, Wellington, Somerset, TA21 9AQ, UK	æœ‰è¿›å£è®°å½•	+44 (0)1823 653400	8:30â€¯amâ€“4:30â€¯pm
JACKODURÂ® by BEWI UK	XPSåšä¿æ¸©æ¿ï¼Œä¹Ÿåšä¿ä¸½é¾™ç›’å­è£…å†·å†»	https://bewi.com/products/jackodur?lang=en-gb	Unit A, Rudford Industrial Estate, Nr Arundel, West Sussex BN+B2418 0BDï¼ˆå—éƒ¨office-head officeï¼‰;Boothferry Works, Howden, East Riding of Yorkshire DN14 7EAï¼ˆåŒ—éƒ¨officeï¼‰	é™Œæ‹œï¼Œç”±å‘è¿‡å¼€å‘ä¿¡	Kay	8:30â€¯amâ€“4â€¯pm
Alchimica Building Chemicals	XPSåšä¿æ¸©æ¿ï¼Œä¹Ÿæœ‰å…¶ä»–å®¶å…·é¡¹ç›®ï¼ˆä¸å¤ªç›¸å…³ï¼‰	https://www.alchimica.com/en	Unit 2, Dairy Park, Spring Gardens, Whitland SA34 0HNè‹±å›½	é™Œæ‹œï¼Œç”±å‘è¿‡å¼€å‘ä¿¡	Kay	8:30â€¯amâ€“5â€¯pm
lvf		https://www.lvfpackaging.com/contact/	Hunslet Business Park, 4 National Rd, Leeds LS10 1TD, United Kingdom	é¡¾å®¢	å˜å§	8am - 5:30pm`;

        /**
         * æ¨¡æ‹Ÿåœ°ç†ç¼–ç ï¼šæ ¹æ®åœ°å€ä¸­çš„åŸå¸‚/åŒºåŸŸè·å–è¿‘ä¼¼çš„ç»çº¬åº¦ã€‚
         */
        const GEOCODE_LOOKUP = {
            "Leeds LS12 6DX": [53.7963, -1.5492, "Leeds"], // Esterform Packaging
            "NORTHAMPTON, NN4 0PB": [52.2359, -0.8920, "Northampton"], // ORANGE & ORANGE LTD
            "Kent, CT3 3EF": [51.3283, 1.1513, "Kent"], // Sharpak
            "Luton, Bedfordshire, LU2 9NH": [51.8789, -0.4172, "Luton"], // Bell Packaging Ltd.
            "83 Tower Road North, BS30 8XP": [51.4545, -2.5879, "Bristol"], // Amcor Bristol HQ
            "4 Sallow Rd, Corby NN17 5JX": [52.4939, -0.6865, "Corby"], // Amcor Corby
            "Blackburn BB1 2PX": [53.7485, -2.4820, "Blackburn"], // Amcor Blackburn
            "250 Thornton Rd, Bradford BD1 2LB": [53.7997, -1.7516, "Bradford"], // Wrapid Mfg Ltd.
            "Davy Way, Llay, Wrexham LL12 0PG": [53.0560, -3.0068, "Wrexham"], // HotPack Packaging UK LTD
            "Ascot Rd, Pershore WR10 2JJ": [52.1264, -2.0076, "Pershore"], // Modern Packaging Ltd.
            "Leicester, LE19 1WH": [52.6333, -1.1333, "Leicester"], // Clifton Packaging & Perimeter
            "Thirsk YO7 3BX": [54.2333, -1.3333, "Thirsk"], // Celli Uk
            "Dundee DD2 4TG, Scotland": [56.4620, -2.9707, "Dundee"], // Sappi Rockwell Solutions Ltd.
            "Nuneaton CV10 7JT": [52.5208, -1.4646, "Nuneaton"], // Staeger Clear Packaging Ltd.
            "Warrington WA3 3GY": [53.3888, -2.5802, "Warrington"], // Alpla UK Warrington
            "Milton Keynes MK10 0AB": [52.0400, -0.7594, "Milton Keynes"], // Alpla UK Milton Keynes
            "Grays RM20 4AL": [51.4754, 0.3013, "Grays"], // Logoplaste UK
            "MIDDLESEX MDDSX HA7 1JZ": [51.6190, -0.3204, "Stanmore"], // Kempner Ltd.
            "Irlam, Manchester M44 5AL": [53.4560, -2.4171, "Manchester"], // Pont Packaging Ltd
            "Wellington, Somerset, TA21 9AQ": [50.9701, -3.2384, "Wellington"], // Kingfisher Packaging Ltd.
            "Arundel, West Sussex BN+B2418 0BD": [50.8550, -0.5529, "Arundel"], // JACKODURÂ® South
            "Howden, East Riding of Yorkshire DN14 7EA": [53.7540, -0.8650, "Howden"], // JACKODURÂ® North
            "Whitland SA34 0HN": [51.7850, -4.6200, "Whitland"], // Alchimica Building Chemicals
            "Leeds LS10 1TD": [53.7788, -1.5316, "Leeds"], // lvf
        };
        
        // ä¼˜å…ˆçº§å®šä¹‰
        const P1_COMPANIES = ["Esterform Packaging", "ORANGE & ORANGE LTD", "Sharpak", "lvf", "JACKODURÂ® by BEWI UK"];
        const P2_COMPANIES = ["Bell Packaging Ltd.", "Amcor Packaging Uk Ltd.", "Wrapid Mfg Ltd.", "HotPack Packaging UK LTD", "Modern Packaging Ltd.", "Clifton Packaging Group Ltd.", "Celli Uk", "Perimeter General Trading Llc", "Sappi Rockwell Solutions Ltd.", "Staeger Clear Packaging Ltd.", "Alpla UK"];

        function getPriority(companyName) {
            const name = companyName.trim();
            if (P1_COMPANIES.includes(name)) {
                return { level: 1, colorClass: 'marker-p1' };
            }
            if (P2_COMPANIES.includes(name)) {
                return { level: 2, colorClass: 'marker-p2' };
            }
            return { level: 3, colorClass: 'marker-p3' };
        }
        
        // å…¨å±€çŠ¶æ€ç®¡ç†
        let mapInstance;
        let selectedMarkers = [];
        let markerLayers = [];
        let currentStartItem = null; // ç”¨äºå­˜å‚¨èµ·ç‚¹æ•°æ®
        let currentEndItem = null;   // ç”¨äºå­˜å‚¨ç»ˆç‚¹æ•°æ®

        /**
         * æ›¿æ¢ alert() çš„è‡ªå®šä¹‰å¼¹çª—
         */
        function showCustomAlert(message) {
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-modal').style.display = 'flex';
        }

        function hideCustomAlert() {
            document.getElementById('custom-modal').style.display = 'none';
        }


        /**
         * é‡æ–°è®¾ç½®é€‰æ‹©
         */
        function resetSelection() {
            // æ¸…é™¤é€‰ä¸­æ ‡è®°çš„æ ·å¼
            selectedMarkers.forEach(marker => {
                // è¿˜åŸå›¾æ ‡ï¼Œç§»é™¤ marker-selected ç±»
                const currentIconHtml = marker.getIcon().options.html;
                const newIconHtml = currentIconHtml.replace(' marker-selected">', '">');

                marker.setIcon(L.divIcon({
                    className: 'custom-marker',
                    html: newIconHtml,
                    iconSize: [22, 22],
                    iconAnchor: [11, 11],
                    popupAnchor: [0, -5]
                }));
            });
            
            selectedMarkers = [];
            currentStartItem = null;
            currentEndItem = null;
            document.getElementById('start-location').textContent = '- å¾…å®š -';
            document.getElementById('end-location').textContent = '- å¾…å®š -';
            document.getElementById('planning-buttons').classList.add('hidden');
            document.getElementById('initial-prompt').classList.remove('hidden');
            document.getElementById('reset-button').classList.add('hidden');
        }

        /**
         * æ ‡è®°ç‚¹å‡»å¤„ç†å‡½æ•°
         * @param {Object} item - æ ‡è®°æ•°æ®
         * @param {L.Marker} marker - Leaflet æ ‡è®°å®ä¾‹
         */
        function handleMarkerClick(item, marker) {
            // ç¡®ä¿ä¸é‡å¤ç‚¹å‡»åŒä¸€ä¸ªç‚¹
            if (selectedMarkers.length === 1 && selectedMarkers[0] === marker) {
                return;
            }

            // æ¸…ç†æ—§çš„é€‰ä¸­çŠ¶æ€
            if (selectedMarkers.length === 2) {
                resetSelection();
            }

            // æ ‡è®°å½“å‰ç‚¹å‡»çš„ç‚¹ä¸ºé€‰ä¸­çŠ¶æ€
            const currentIconHtml = marker.getIcon().options.html;
            
            // ç¡®ä¿æ·»åŠ  marker-selected ç±»
            let newIconHtml = currentIconHtml;
            if (!currentIconHtml.includes('marker-selected')) {
                 // æ‰¾åˆ°ç±»åç»“æŸçš„åŒå¼•å·å‰ï¼Œæ’å…¥ marker-selected
                newIconHtml = currentIconHtml.replace('">', ' marker-selected">');
            }

            marker.setIcon(L.divIcon({
                className: 'custom-marker',
                html: newIconHtml,
                iconSize: [22, 22],
                iconAnchor: [11, 11],
                popupAnchor: [0, -5]
            }));
            
            selectedMarkers.push(marker);
            
            const startLocEl = document.getElementById('start-location');
            const endLocEl = document.getElementById('end-location');
            const resetButton = document.getElementById('reset-button');
            const initialPrompt = document.getElementById('initial-prompt');
            const planningButtons = document.getElementById('planning-buttons');
            
            if (selectedMarkers.length === 1) {
                // é€‰æ‹©äº†èµ·ç‚¹
                currentStartItem = item;
                startLocEl.textContent = `${item.name} (${item.locationName})`;
                endLocEl.textContent = '- å¾…å®š -';
                resetButton.classList.remove('hidden');
                planningButtons.classList.add('hidden');
                initialPrompt.classList.remove('hidden');
            } else if (selectedMarkers.length === 2) {
                // é€‰æ‹©äº†ç»ˆç‚¹
                currentEndItem = item;
                
                endLocEl.textContent = `${item.name} (${item.locationName})`;
                initialPrompt.classList.add('hidden');
                planningButtons.classList.remove('hidden');
            }
        }

        /**
         * æ ¹æ®é€‰ä¸­çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œè·³è½¬åˆ° Google Maps è¿›è¡Œè·¯çº¿è§„åˆ’ã€‚
         * @param {string} mode - äº¤é€šæ¨¡å¼: 'driving' æˆ– 'transit'
         */
        function openGoogleMaps(mode) {
            if (!currentStartItem || !currentEndItem) {
                showCustomAlert("è¯·å…ˆé€‰æ‹©åœ°å›¾ä¸Šçš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼"); 
                return;
            }
            
            // ä½¿ç”¨ full address æˆ– name + locationName ç»„åˆä½œä¸ºèµ·ç‚¹å’Œç»ˆç‚¹
            // ä½¿ç”¨åœ°å€æ›´ç²¾ç¡®
            const origin = currentStartItem.address; 
            const destination = currentEndItem.address;

            // æ„é€  Google Maps Directions URL
            const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}&travelmode=${mode}`;
            
            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€
            window.open(url, "_blank");
        }

        /**
         * è§£æåŸå§‹æ•°æ®å¹¶æ‰å¹³åŒ–ä¸ºå¯ç»˜åˆ¶æ ‡è®°çš„åˆ—è¡¨ã€‚
         */
        function parseData(data) {
            const lines = data.trim().split('\n');
            const headers = lines[0].split('\t').map(h => h.trim());
            const markers = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split('\t').map(v => v.trim());
                if (values.length !== headers.length) continue;

                const companyData = {};
                headers.forEach((header, index) => {
                    companyData[header] = values[index] || '-';
                });

                const { 
                    åå­—: name, 
                    åœ°å€: rawAddress, 
                    ...details 
                } = companyData;
                
                const addresses = rawAddress.split(';').map(addr => addr.trim()).filter(addr => addr.length > 0);

                const priorityInfo = getPriority(name);

                addresses.forEach(address => {
                    let coords = null;
                    let locationName = address;

                    // å°è¯•åŒ¹é…åœ°å€ç‰‡æ®µåˆ° GEOCODE_LOOKUP
                    for (const key in GEOCODE_LOOKUP) {
                        if (address.includes(key)) {
                            const [lat, lng, locName] = GEOCODE_LOOKUP[key];
                            coords = [lat, lng];
                            locationName = locName;
                            break;
                        }
                    }

                    if (coords) {
                        markers.push({
                            name,
                            address,
                            coords,
                            locationName,
                            ...details,
                            priority: priorityInfo 
                        });
                    }
                });
            }

            return markers;
        }

        /**
         * åˆ›å»º Leaflet åœ°å›¾å’Œæ ‡è®°ã€‚
         */
        function initializeMap() {
            mapInstance = L.map('map', {
                zoomSnap: 0.5,
                zoomDelta: 0.5
            }).setView([54.0, -2.0], 6); 

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                updateWhenIdle: true 
            }).addTo(mapInstance);

            const allMarkersData = parseData(rawData);
            const markerGroup = L.featureGroup();

            allMarkersData.forEach(item => {
                const { name, coords, priority, ...details } = item;
                const [lat, lng] = coords;
                
                // 1. åˆ›å»ºè‡ªå®šä¹‰æ ‡è®°å›¾æ ‡ï¼ˆå½©è‰²åœ†ç‚¹ï¼‰
                const customIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div class="custom-marker-dot ${priority.colorClass}"></div>`,
                    iconSize: [22, 22],
                    iconAnchor: [11, 11],
                    popupAnchor: [0, -5]
                });

                // 2. æ ¼å¼åŒ–å¼¹å‡ºçª—å£å†…å®¹
                const websiteLink = details['ç½‘å€'] && details['ç½‘å€'] !== '-' 
                    ? `<a href="${details['ç½‘å€']}" target="_blank" class="text-blue-500 hover:text-blue-700 hover:underline transition-colors duration-150">è®¿é—®ç½‘ç«™</a>`
                    : 'æš‚æ— ';
                
                const priorityText = priority.level === 1 ? 'é«˜ä¼˜å…ˆçº§ P1 (é¡¾å®¢)' : 
                                     priority.level === 2 ? 'ä¸­ä¼˜å…ˆçº§ P2 (é‡ç‚¹é¡¾å®¢)' : 'ä¸€èˆ¬ä¼˜å…ˆçº§ P3 (å…¶ä»–)';

                const popupContent = `
                    <div class="p-3 text-sm">
                        <h3 class="text-lg font-bold text-indigo-700 mb-2">${name}</h3>
                        <p class="font-semibold text-gray-700 mb-2">ğŸ“Œ ${item.locationName} - ${priorityText}</p>
                        <div class="space-y-1">
                            <p><strong>ä¸»è¥ä¸šåŠ¡:</strong> ${details['ä¸»è¥ä¸šåŠ¡']}</p>
                            <p><strong>åœ°å€:</strong> ${item.address}</p>
                            <p><strong>ç½‘å€:</strong> ${websiteLink}</p>
                            <p><strong>è´Ÿè´£äºº:</strong> ${details['è´Ÿè´£äºº']}</p>
                            <p><strong>è¥ä¸šæ—¶é—´:</strong> ${details['è¥ä¸šæ—¶é—´']}</p>
                            <p><strong>å¤‡æ³¨:</strong> <span class="text-orange-600 font-medium">${details['å¤‡æ³¨']}</span></p>
                        </div>
                    </div>
                `;

                // 3. åˆ›å»ºæ ‡è®°ã€ç»‘å®šæ•°æ®å’Œç‚¹å‡»äº‹ä»¶
                const marker = L.marker([lat, lng], { 
                    icon: customIcon,
                    title: `${name} (${item.locationName})`,
                    itemData: item // å°†æ•°æ®é™„åŠ åˆ°æ ‡è®°å¯¹è±¡ä¸Š
                });
                
                marker.bindPopup(popupContent, { 
                    maxWidth: 350, 
                    minWidth: 200 
                });

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºäº¤é€šè§„åˆ’
                marker.on('click', function() {
                    handleMarkerClick(item, marker);
                });

                markerLayers.push(marker);
                markerGroup.addLayer(marker);
            });

            markerGroup.addTo(mapInstance);

            if (markerGroup.getLayers().length > 0) {
                mapInstance.fitBounds(markerGroup.getBounds().pad(0.1));
            } else {
                mapInstance.setView([54.0, -2.0], 6);
            }
        }

        window.onload = initializeMap;
    </script>
</body>
</html>
